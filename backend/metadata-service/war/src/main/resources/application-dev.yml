# å¼€å‘ç¯å¢ƒä¸“ç”¨é…ç½®
# ä½¿ç”¨æ–¹å¼ï¼š--spring.profiles.active=dev
# æ­¤é…ç½®ä¼šè¦†ç›– application.yml ä¸­çš„å ä½ç¬¦ï¼Œæ— éœ€è®¾ç½®ç¯å¢ƒå˜é‡

server:
  port: 8080

# ===== æ•°æ®åº“é…ç½® =====
spring:
  datasource:
    url: jdbc:mysql://47.80.65.112:3306/metapulse?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
    username: metapulse
    password: metapulse
    driver-class-name: com.mysql.cj.jdbc.Driver

    hikari:
      maximum-pool-size: 20  # å¼€å‘ç¯å¢ƒå‡å°‘è¿æ¥æ± 
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    show-sql: true  # å¼€å‘ç¯å¢ƒæ˜¾ç¤º SQL
    properties:
      hibernate:
        format_sql: true  # æ ¼å¼åŒ– SQL è¾“å‡º

  # å¼€å‘ç¯å¢ƒç¦ç”¨é™æ€èµ„æºç¼“å­˜
  web:
    resources:
      cache:
        period: 0
        cachecontrol:
          no-cache: true
          no-store: true
      chain:
        enabled: false

# ===== Kafkaé…ç½® =====
kafka:
  bootstrapServers: 47.80.65.112:9092

  schemaRegistry:
    url: http://localhost:8080/schema-registry/api
    type: INTERNAL

  # Produceré…ç½® - å¢åŠ è¶…æ—¶é€‚åº”è¿œç¨‹Kafka
  producer:
    acks: all
    retries: 3
    compressionType: snappy
    maxRequestSize: 1048576
    requestTimeoutMs: 120000      # è¯·æ±‚è¶…æ—¶ï¼š120ç§’ï¼ˆé»˜è®¤30ç§’ï¼‰
    deliveryTimeoutMs: 180000     # æŠ•é€’è¶…æ—¶ï¼š180ç§’ï¼ˆé»˜è®¤120ç§’ï¼‰
    maxBlockMs: 180000            # æœ€å¤§é˜»å¡æ—¶é—´ï¼š180ç§’ï¼ˆé»˜è®¤60ç§’ï¼‰

  consumer:
    groupId: metapulse-dev-consumers
    autoOffsetReset: earliest
    requestTimeoutMs: 120000      # è¯·æ±‚è¶…æ—¶ï¼š120ç§’ï¼ˆé»˜è®¤30ç§’ï¼‰

  listener:
    concurrency: 2  # å¼€å‘ç¯å¢ƒå‡å°‘å¹¶å‘

# ===== Elasticsearché…ç½® =====
elasticsearch:
  host: 47.80.65.112
  port: 9200
  scheme: http
  username:
  password:
  threadCount: 2  # å¼€å‘ç¯å¢ƒå‡å°‘çº¿ç¨‹

# ===== Consumerå¼€å…³ï¼ˆå¼€å‘ç¯å¢ƒå…¨éƒ¨å¯ç”¨ï¼‰ =====
# æ³¨æ„ï¼šè¿™äº›éœ€è¦ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ï¼Œæˆ–è€…åœ¨å¯åŠ¨æ—¶ä½¿ç”¨ -D å‚æ•°
# ç¤ºä¾‹ï¼šjava -DMCE_CONSUMER_ENABLED=true -DMCP_CONSUMER_ENABLED=true ...
#
# ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡ Spring Boot çš„é»˜è®¤å€¼æœºåˆ¶è®¾ç½®
# å®é™…çš„æ¡ä»¶åˆ¤æ–­ä¼šè¯»å–è¿™äº›å±æ€§

# ===== Entity Clienté…ç½® =====
entityClient:
  impl: java  # æœ¬åœ°æ–¹æ³•è°ƒç”¨

# ===== è®¤è¯é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒå¯é€‰æ‹©å…³é—­ï¼‰ =====
authentication:
  enabled: false  # å¼€å‘ç¯å¢ƒå»ºè®®å…³é—­è®¤è¯ï¼Œæ–¹ä¾¿æµ‹è¯•
  systemClientId: __datahub_system
  systemClientSecret: JohnSnowKnowsNothing
  tokenService:
    signingKey: WnVBrnu2tBFoY5rLnQmVlQ==

# ===== æ—¥å¿—é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒæ›´è¯¦ç»†ï¼‰ =====
logging:
  level:
    root: INFO
    com.linkedin: DEBUG  # DataHub ç›¸å…³ä»£ç å¼€å¯ DEBUG
    com.linkedin.gms: DEBUG
    com.linkedin.metadata: DEBUG
    org.springframework: INFO
    org.springframework.web: DEBUG  # Web è¯·æ±‚æ—¥å¿—
    org.apache.kafka: WARN
    org.hibernate.SQL: DEBUG  # æ˜¾ç¤º SQL
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE  # æ˜¾ç¤º SQL å‚æ•°
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# ===== ç®¡ç†ç«¯ç‚¹ï¼ˆå¼€å‘ç¯å¢ƒå…¨éƒ¨å¼€æ”¾ï¼‰ =====
management:
  endpoints:
    web:
      exposure:
        include: "*"  # å¼€å‘ç¯å¢ƒæš´éœ²æ‰€æœ‰ç«¯ç‚¹
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯

# ===== DataHub GMSé…ç½® =====
datahub:
  gms:
    host: 0.0.0.0
    port: 8080
    useSSL: false

# ===== ç¼“å­˜é…ç½® =====
cache:
  client:
    entityClient:
      useCaffeineCache: true
      statsEnabled: true

# ===== å…¶ä»–é…ç½® =====
metadataChangeProposal:
  throttle:
    updateIntervalMs: 60000

telemetry:
  enabledCli: false  # å¼€å‘ç¯å¢ƒç¦ç”¨xian zhé¥æµ‹
  enabledServer: false

# ===== Ebean é…ç½®ï¼ˆæ•°æ®åº“è¡¨è‡ªåŠ¨åˆ›å»ºï¼‰ =====
ebean:
  username: metapulse
  password: metapulse
  url: jdbc:mysql://47.80.65.112:3306/metapulse?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
  driver: com.mysql.cj.jdbc.Driver
  autoCreateDdl: true  # âœ¨ å…³é”®é…ç½®ï¼šå¯ç”¨è‡ªåŠ¨å»ºè¡¨

# ===== Entity Registry é…ç½® =====
# ä½¿ç”¨ classpath æ–¹å¼åŠ è½½ï¼ˆæ–‡ä»¶åœ¨ metadata-models æ¨¡å—ä¸­ï¼‰
configEntityRegistry:
  path: ${ENTITY_REGISTRY_CONFIG_PATH:#{null}}  # æ˜ç¡®è®¾ç½®ä¸º nullï¼Œé¿å…ä½¿ç”¨ç›¸å¯¹è·¯å¾„
  resource: classpath:entity-registry.yml

# ===== ç³»ç»Ÿæ›´æ–°é…ç½® =====
# è·³è¿‡ç³»ç»Ÿæ›´æ–°ç­‰å¾…ï¼Œå¼€å‘ç¯å¢ƒå¿«é€Ÿå¯åŠ¨
systemUpdate:
  waitForSystemUpdate: false  # ğŸ”‘ å…³é”®é…ç½®ï¼šè·³è¿‡Kafkaç³»ç»Ÿæ›´æ–°æ¶ˆæ¯ç­‰å¾…
