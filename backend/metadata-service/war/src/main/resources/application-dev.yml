# å¼€å‘ç¯å¢ƒä¸“ç”¨é…ç½®
# ä½¿ç”¨æ–¹å¼ï¼š--spring.profiles.active=dev
# æ­¤é…ç½®ä¼šè¦†ç›– application.yml ä¸­çš„å ä½ç¬¦ï¼Œæ— éœ€è®¾ç½®ç¯å¢ƒå˜é‡

server:
  port: 8080
  # å¢åŠ  Jetty å¼‚æ­¥è¯·æ±‚è¶…æ—¶ï¼ˆä»é»˜è®¤ 30 ç§’å¢åŠ åˆ° 120 ç§’ï¼‰
  jetty:
    threads:
      max: 200  # æœ€å¤§çº¿ç¨‹æ•°
      min: 8    # æœ€å°çº¿ç¨‹æ•°
    connection:
      idle-timeout: 120000  # è¿æ¥ç©ºé—²è¶…æ—¶ï¼š120 ç§’

# Spring MVC å¼‚æ­¥è¯·æ±‚é…ç½®
spring.mvc.async.request-timeout: 120000  # 120 ç§’

# ===== Consumer å¯ç”¨å¼€å…³ï¼ˆå¼€å‘ç¯å¢ƒå…¨éƒ¨å¯ç”¨ï¼‰ =====
environment:
  MAE_CONSUMER_ENABLED: "true"
  MCE_CONSUMER_ENABLED: "true"
  MCP_CONSUMER_ENABLED: "true"
  PE_CONSUMER_ENABLED: "true"

# ===== Entity Clienté…ç½® =====
entityClient:
  impl: java  # æœ¬åœ°æ–¹æ³•è°ƒç”¨

# ===== æ•°æ®åº“é…ç½® =====
spring:
  datasource:
    url: jdbc:mysql://47.80.65.112:3306/metapulse?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=10
    username: metapulse
    password: metapulse
    driver-class-name: com.mysql.cj.jdbc.Driver

    hikari:
      maximum-pool-size: 30              # å¢åŠ è¿æ¥æ± å¤§å°ä»¥æ”¯æŒå¹¶å‘æŸ¥è¯¢
      minimum-idle: 10                   # å¢åŠ æœ€å°ç©ºé—²è¿æ¥
      connection-timeout: 30000          # è¿æ¥è·å–è¶…æ—¶ï¼š30ç§’
      idle-timeout: 600000               # ç©ºé—²è¿æ¥å­˜æ´»æ—¶é—´ï¼š10åˆ†é’Ÿ
      max-lifetime: 1800000              # è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼š30åˆ†é’Ÿ
      connection-test-query: SELECT 1    # è¿æ¥æµ‹è¯•æŸ¥è¯¢
      validation-timeout: 3000           # éªŒè¯è¶…æ—¶ï¼š3ç§’
      leak-detection-threshold: 60000    # è¿æ¥æ³„æ¼æ£€æµ‹ï¼š60ç§’
      pool-name: HikariPool-MetaPulse    # è¿æ¥æ± åç§°ï¼ˆä¾¿äºæ—¥å¿—è¿½è¸ªï¼‰

  jpa:
    show-sql: true  # å¼€å‘ç¯å¢ƒæ˜¾ç¤º SQL
    properties:
      hibernate:
        format_sql: true  # æ ¼å¼åŒ– SQL è¾“å‡º

  # å¼€å‘ç¯å¢ƒç¦ç”¨é™æ€èµ„æºç¼“å­˜
  web:
    resources:
      cache:
        period: 0
        cachecontrol:
          no-cache: true
          no-store: true
      chain:
        enabled: false

# ===== Kafkaé…ç½® =====
kafka:
  bootstrapServers: 47.80.65.112:9092

  schemaRegistry:
    url: http://localhost:8080/schema-registry/api
    type: INTERNAL

  # Produceré…ç½® - å¢åŠ è¶…æ—¶é€‚åº”è¿œç¨‹Kafka
  producer:
    acks: all
    retries: 3
    compressionType: snappy
    maxRequestSize: 1048576
    requestTimeoutMs: 120000          # è¯·æ±‚è¶…æ—¶ï¼š120ç§’ï¼ˆé»˜è®¤30ç§’ï¼‰
    deliveryTimeoutMs: 180000         # æŠ•é€’è¶…æ—¶ï¼š180ç§’ï¼ˆé»˜è®¤120ç§’ï¼‰
    maxBlockMs: 180000                # æœ€å¤§é˜»å¡æ—¶é—´ï¼š180ç§’ï¼ˆé»˜è®¤60ç§’ï¼‰
    # é¢å¤–çš„ç½‘ç»œå’Œè¶…æ—¶é…ç½®
    metadataMaxAgeMs: 300000          # å…ƒæ•°æ®æœ€å¤§ç¼“å­˜æ—¶é—´ï¼š5åˆ†é’Ÿ
    reconnectBackoffMs: 50            # é‡è¿é€€é¿æ—¶é—´ï¼š50æ¯«ç§’
    reconnectBackoffMaxMs: 1000       # æœ€å¤§é‡è¿é€€é¿æ—¶é—´ï¼š1ç§’
    # Spring Kafka ç‰¹å®šé…ç½®ï¼ˆç¡®ä¿è¦†ç›–é»˜è®¤å€¼ï¼‰
    properties:
      request.timeout.ms: 120000      # å†æ¬¡æ˜ç¡®è®¾ç½®è¯·æ±‚è¶…æ—¶
      delivery.timeout.ms: 180000     # å†æ¬¡æ˜ç¡®è®¾ç½®æŠ•é€’è¶…æ—¶
      max.block.ms: 180000            # å†æ¬¡æ˜ç¡®è®¾ç½®æœ€å¤§é˜»å¡æ—¶é—´
      metadata.max.age.ms: 300000     # å…ƒæ•°æ®è¿‡æœŸæ—¶é—´
      connections.max.idle.ms: 540000 # è¿æ¥æœ€å¤§ç©ºé—²æ—¶é—´ï¼š9åˆ†é’Ÿ

  consumer:
    groupId: metapulse-dev-consumers
    autoOffsetReset: earliest
    requestTimeoutMs: 120000      # è¯·æ±‚è¶…æ—¶ï¼š120ç§’ï¼ˆé»˜è®¤30ç§’ï¼‰

  listener:
    concurrency: 2  # å¼€å‘ç¯å¢ƒå‡å°‘å¹¶å‘

# ===== Elasticsearché…ç½® =====
elasticsearch:
  host: 47.80.65.112
  port: 9200
  scheme: http
  username:
  password:
  threadCount: 2  # å¼€å‘ç¯å¢ƒå‡å°‘çº¿ç¨‹

# ===== è®¤è¯é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ =====
authentication:
  enabled: true  # å¯ç”¨è®¤è¯ï¼Œä½¿ç”¨ metapulse-admin/metapulse-admin ç™»å½•
  excludedPaths: /logIn,/schema-registry/*,/health,/health/live,/config,/config/search/export,/public-iceberg/*,/actuator/prometheus
  systemClientId: __datahub_system
  systemClientSecret: JohnSnowKnowsNothing
  tokenService:
    signingKey: +8Qx7hZjcZq21cdr9f0paEceHRw47YU5pRt4P7fWpSc=  # 256-bit key for HS256

# ===== æ—¥å¿—é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒæ›´è¯¦ç»†ï¼‰ =====
logging:
  level:
    root: INFO
    com.linkedin: DEBUG  # DataHub ç›¸å…³ä»£ç å¼€å¯ DEBUG
    com.linkedin.gms: DEBUG
    com.linkedin.metadata: DEBUG
    org.springframework: INFO
    org.springframework.web: DEBUG  # Web è¯·æ±‚æ—¥å¿—
    org.apache.kafka: WARN
    org.hibernate.SQL: DEBUG  # æ˜¾ç¤º SQL
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE  # æ˜¾ç¤º SQL å‚æ•°
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# ===== ç®¡ç†ç«¯ç‚¹ï¼ˆå¼€å‘ç¯å¢ƒå…¨éƒ¨å¼€æ”¾ï¼‰ =====
management:
  endpoints:
    web:
      exposure:
        include: "*"  # å¼€å‘ç¯å¢ƒæš´éœ²æ‰€æœ‰ç«¯ç‚¹
  endpoint:
    health:
      show-details: always  # æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯

# ===== DataHub GMSé…ç½® =====
datahub:
  gms:
    host: 0.0.0.0
    port: 8080
    useSSL: false

# ===== ç¼“å­˜é…ç½® =====
cache:
  client:
    entityClient:
      useCaffeineCache: true
      statsEnabled: true

# ===== å…¶ä»–é…ç½® =====
metadataChangeProposal:
  throttle:
    updateIntervalMs: 60000

telemetry:
  enabledCli: false  # å¼€å‘ç¯å¢ƒç¦ç”¨xian zhé¥æµ‹
  enabledServer: false

# ===== ä¸»æ•°æ®åº“é…ç½® (master_data) =====
# ç”¨äºå­˜å‚¨å¤–éƒ¨æ•°æ®åº“çš„é•œåƒæ•°æ®ï¼Œæ”¯æŒæ•°æ®æ¥å…¥å±‚ CDC åŒæ­¥
masterData:
  datasource:
    url: jdbc:mysql://47.80.65.112:3306/master_data?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
    username: metapulse
    password: metapulse
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      pool-name: MasterDataPool
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

# ===== Ebean é…ç½®ï¼ˆæ•°æ®åº“è¡¨è‡ªåŠ¨åˆ›å»ºï¼‰ =====
ebean:
  username: metapulse
  password: metapulse
  url: jdbc:mysql://47.80.65.112:3306/metapulse?useUnicode=true&characterEncoding=UTF-8&useSSL=false&allowPublicKeyRetrieval=true
  driver: com.mysql.cj.jdbc.Driver
  autoCreateDdl: false  # å…³é—­è‡ªåŠ¨å»ºè¡¨ï¼Œä¿ç•™æ•°æ®åº“æ•°æ®

# ===== Entity Registry é…ç½® =====
# ä½¿ç”¨ classpath æ–¹å¼åŠ è½½ï¼ˆæ–‡ä»¶åœ¨ metadata-models æ¨¡å—ä¸­ï¼‰
configEntityRegistry:
  path: ${ENTITY_REGISTRY_CONFIG_PATH:#{null}}  # æ˜ç¡®è®¾ç½®ä¸º nullï¼Œé¿å…ä½¿ç”¨ç›¸å¯¹è·¯å¾„
  resource: classpath:entity-registry.yml

# ===== ç³»ç»Ÿæ›´æ–°é…ç½® =====
# è·³è¿‡ç³»ç»Ÿæ›´æ–°ç­‰å¾…ï¼Œå¼€å‘ç¯å¢ƒå¿«é€Ÿå¯åŠ¨
systemUpdate:
  waitForSystemUpdate: false  # ğŸ”‘ å…³é”®é…ç½®ï¼šè·³è¿‡Kafkaç³»ç»Ÿæ›´æ–°æ¶ˆæ¯ç­‰å¾…

# ===== é»˜è®¤ç”¨æˆ·é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ =====
defaultUser:
  enabled: true
  username: metapulse-admin
  password: metapulse-admin
  fullName: MetaPulse Admin
  email: admin@metapulse.com
  title: Administrator
